<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FilesHub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <%= stylesheet_link_tag 'dashboard', media: 'all', 'data-turbo-track': 'reload' %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body data-controller="dashboard">
  <!-- Hamburger toggle for small screens, fixed at top-left -->
  <button
    id="sidebarToggleBtn"
    class="btn btn-dark d-md-none position-fixed"
    style="top: 16px; left: 16px; z-index: 1051; border-radius: 50%; width: 44px; height: 44px; padding: 0; display: flex; align-items: center; justify-content: center;"
    type="button"
    data-bs-toggle="offcanvas"
    data-bs-target="#sidebarOffcanvas"
    aria-controls="sidebarOffcanvas"
    aria-label="Open sidebar"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M2.5 12.5a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5z"/>
    </svg>
  </button>
  <div class="content-wrapper d-flex">
    <!-- Sidebar for md and up -->

    <div class="sidebar p-3 text-bg-dark d-none d-md-block" style="width: 280px;">
      <%= image_tag 'logo.jpg', alt: 'logo', width: '50%', style: 'border-radius: 10px;' %>
      <hr>
      <ul class="nav nav-pills flex-column mb-auto" data-dashboard-target="adminMenu">
        <li><a href="#" class="nav-link active" data-bs-toggle="modal" data-bs-target="#empresasModal"><i class="bi bi-building me-2"></i>Empresas asociadas</a></li>
        <li><a href="#" class="nav-link text-white" data-bs-toggle="modal" data-bs-target="#institucionModal"><i class="bi bi-bank me-2"></i>Cambiar institución</a></li>
        <li><a href="<%= manage_folders_path %>" class="nav-link text-white"><i class="bi bi-file-earmark me-2"></i>Gestionar archivos</a></li>
        <li><a href="<%= manage_users_path %>" class="nav-link text-white"><i class="bi bi-people me-2"></i>Gestionar usuarios</a></li>
        <li><a href="<%= manage_companies_path %>" class="nav-link text-white"><i class="bi bi-buildings me-2"></i>Gestionar empresas</a></li>
      </ul>
      <ul class="nav nav-pills flex-column mb-auto" data-dashboard-target="clientMenu">
        <li><a href="#" class="nav-link active" data-bs-toggle="modal" data-bs-target="#empresasModal"><i class="bi bi-building me-2"></i>Empresas asociadas</a></li>
        <li><a href="#" class="nav-link text-white" data-bs-toggle="modal" data-bs-target="#institucionModal"><i class="bi bi-bank me-2"></i>Cambiar institución</a></li>
      </ul>
      <hr>
      <div class="dropdown">
        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown">
          <%= image_tag 'profile.png', alt: 'admin', width: '32', class: 'rounded-circle me-2' %>
          <span data-dashboard-target="username">name</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
          <li><a class="dropdown-item" href="#">Perfil</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="#" id="logoutButton" data-action="click->dashboard#logout">Cerrar sesión</a></li>
        </ul>
      </div>
    </div>

    <!-- Offcanvas sidebar for small screens -->
    <div class="offcanvas offcanvas-start d-md-none text-bg-dark" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel" style="width: 240px;">
      <div class="offcanvas-header border-bottom">
        <%= image_tag 'logo.jpg', alt: 'logo', width: '36', style: 'border-radius: 8px;' %>
        <span class="ms-2 fw-bold">FilesHub</span>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body p-3">
        <ul class="nav nav-pills flex-column mb-auto" data-dashboard-target="adminMenuMobile">
          <li><a href="#" class="nav-link active" data-bs-toggle="modal" data-bs-target="#empresasModal"><i class="bi bi-building me-2"></i>Empresas asociadas</a></li>
          <li><a href="#" class="nav-link text-white" data-bs-toggle="modal" data-bs-target="#institucionModal"><i class="bi bi-bank me-2"></i>Cambiar institución</a></li>
          <li><a href="<%= manage_folders_path %>" class="nav-link text-white"><i class="bi bi-file-earmark me-2"></i>Gestionar archivos</a></li>
          <li><a href="<%= manage_users_path %>" class="nav-link text-white"><i class="bi bi-people me-2"></i>Gestionar usuarios</a></li>
          <li><a href="<%= manage_companies_path %>" class="nav-link text-white"><i class="bi bi-buildings me-2"></i>Gestionar empresas</a></li>
        </ul>
        <ul class="nav nav-pills flex-column mb-auto" data-dashboard-target="clientMenuMobile">
          <li><a href="#" class="nav-link active" data-bs-toggle="modal" data-bs-target="#empresasModal"><i class="bi bi-building me-2"></i>Empresas asociadas</a></li>
          <li><a href="#" class="nav-link text-white" data-bs-toggle="modal" data-bs-target="#institucionModal"><i class="bi bi-bank me-2"></i>Cambiar institución</a></li>
        </ul>
        <hr>
        <div class="dropdown">
          <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="userDropdownMobile" data-bs-toggle="dropdown">
            <%= image_tag 'profile.png', alt: 'admin', width: '32', class: 'rounded-circle me-2' %>
            <span data-dashboard-target="username">name</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
            <li><a class="dropdown-item" href="#">Perfil</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" id="logoutButtonMobile" data-action="click->dashboard#logout">Cerrar sesión</a></li>
          </ul>
        </div>
      </div>
    </div>

  <div class="container-fluid">
    <nav class="navbar navbar-light bg-light border-bottom">
      <div class="container-fluid">
        <button id="backButton" class="btn btn-link ps-0" data-dashboard-target="backButton" data-action="click->dashboard#loadInitialData">
          <i class="bi bi-arrow-left me-2"></i>Atrás
        </button>
        <span class="navbar-text fw-bold" id="title" data-dashboard-target="title"></span>
      </div>
    </nav>
    <div class="container-fluid p-3" id="mainContent">
      <div id="Feed" class="row" data-dashboard-target="Feed"></div>
    </div>
  </div>
</div>
<div class="modal fade" id="empresasModal" tabindex="-1" aria-labelledby="empresasModalLabel">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cambiar empresa</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="empresasForm" data-action="submit->dashboard#changeEmpresa">
          <label for="empresasDropdown" class="form-label">Seleccionar empresa</label>
          <select class="form-select" id="empresasDropdown" data-dashboard-target="empresasDropdown"></select>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="submit" class="btn btn-primary">Aceptar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="institucionModal" tabindex="-1" aria-labelledby="institucionModalLabel">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cambiar institución</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="institucionForm" data-action="submit->dashboard#changeInstitucion">
          <label for="institucionDropdown" class="form-label">Seleccionar institución</label>
          <select class="form-select" id="institucionDropdown" data-dashboard-target="institucionDropdown"></select>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="submit" class="btn btn-primary">Aceptar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
</body>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var offcanvas = document.getElementById('sidebarOffcanvas');
    var toggleBtn = document.getElementById('sidebarToggleBtn');
    if (offcanvas && toggleBtn) {
      offcanvas.addEventListener('show.bs.offcanvas', function() {
        toggleBtn.classList.add('d-none');
      });
      offcanvas.addEventListener('hidden.bs.offcanvas', function() {
        toggleBtn.classList.remove('d-none');
      });
    }
  });
</script>
</html>